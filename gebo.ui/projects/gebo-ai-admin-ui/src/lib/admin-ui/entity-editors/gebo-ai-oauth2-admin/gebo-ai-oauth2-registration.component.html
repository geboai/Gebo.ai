<p-panel header="Insert new OAUTH2 Authentication/Integration infos" [formGroup]="formGroup">
    <p-messages [(value)]="userMessages" [enableService]="false" [closable]="false" />
    <div class="grid geboDialogContent">
        <div class="col-6" *ngIf="redirectUrls?.length">
            <p-fieldset legend="Redirect urls to enable on oauth2 provider">
                <ul>
                    <li *ngFor="let h of redirectUrls;">{{h}}</li>
                </ul>
            </p-fieldset>
        </div>
        <div class="col-6" *ngIf="redirectUrls?.length">
            <p-fieldset legend="Referer urls to enable on oauth2 provider">
                <ul>
                    <li *ngFor="let h of refererUrls;">{{h}}</li>
                </ul>
            </p-fieldset>
        </div>

        <div class="col-6">
            <div class="flex flex-column gap-2">
                <label for="description">Description</label>
                <input pInputText id="description" formControlName="description" maxlength="120" [readOnly]="readonly"
                    aria-describedby="description-help" />
                <small id="description-help">
                    Enter the description of OAUTH2 Authentication/Integration infos.
                </small>
            </div>
        </div>
        <div class="col-6">
            <div class="flex flex-column gap-2">
                <label for="code">Code</label>
                <input pInputText id="code" formControlName="code" [readOnly]="true" aria-describedby="code-help" />
                <small id="description-help">
                    Enter the description of OAUTH2 Authentication/Integration code (registrationId).
                </small>
            </div>
        </div>
        <div class="col-6">
            <div class="flex flex-column gap-2 ">
                <label for="authProvider">Provider</label>
                <geboai-editable-listbox-component formControlName="authProvider" placeholder="Select a OAUTH2 provider"
                    [readonly]="readonly || mode!=='NEW'" [data]="providers" aria-describedby="authProvider-help">
                </geboai-editable-listbox-component>
                <small id="authProvider-help">
                    Enter the provider of OAUTH2 Authentication
                </small>
            </div>
        </div>

        <div class="col-6">
            <div class="flex flex-column gap-2">
                <label for="configurationTypes">Configuration purpose</label>
                <p-multiselect [options]="configurationTypesData" formControlName="configurationTypes"
                    optionLabel="description" optionValue="code" placeholder="Select configuration purpose"
                    styleClass="w-full md:w-80" aria-describedby="configurationTypes-help" [readonly]="readonly" />
                <small id="configurationTypes-help">
                    Choose if this settings will be used for 
                    Authenticate in Gebo.ai or to let Gebo.ai have client connectivity to a 3rd party system.
                </small>
            </div>
        </div>
        <div class="col-12" formGroupName="providerConfiguration" [hidden]="currentProvider!=='oauth2_generic'"
            *ngIf="readonly!==true">
            <p-fieldset legend="OAUTH2 provider URLS">
                <div class="grid">
                    <div class="col-12">
                        <div class="flex flex-column gap-2">
                            <label for="authorizationUri">Authorization URL</label>
                            <input pInputText id="authorizationUri" formControlName="authorizationUri"
                                [readOnly]="readonly" aria-describedby="authorizationUri-help" />
                            <small id="authorizationUri-help">
                                Enter the OAUTH2 Authorization URL of the provider
                            </small>
                        </div>

                    </div>
                    <div class="col-12">
                        <div class="flex flex-column gap-2">
                            <label for="tokenUri">Token URL</label>
                            <input pInputText id="tokenUri" formControlName="tokenUri" [readOnly]="readonly"
                                aria-describedby="tokenUri-help" />
                            <small id="tokenUri-help">
                                Enter the OAUTH2 Token URL of the provider
                            </small>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="flex flex-column gap-2">
                            <label for="userInfoUri">User info URL</label>
                            <input pInputText id="userInfoUri" formControlName="userInfoUri" [readOnly]="readonly"
                                aria-describedby="userInfoUri-help" />
                            <small id="userInfoUri-help">
                                Enter the OAUTH2 User info Url URL of the provider
                            </small>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="flex flex-column gap-2">
                            <label for="introspectionUri">Introspection Uri</label>
                            <input pInputText id="introspectionUri" formControlName="introspectionUri"
                                [readOnly]="readonly" aria-describedby="introspectionUri-help" />
                            <small id="introspectionUri-help">
                                Enter the OAUTH2 introspection URL of the provider
                            </small>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="flex flex-column gap-2">
                            <label for="issuerUri">Issuer Uri</label>
                            <input pInputText id="issuerUri" formControlName="issuerUri" [readOnly]="readonly"
                                aria-describedby="issuerUri-help" />
                            <small id="issuerUri-help">
                                Enter the OAUTH2 issuer URL of the provider
                            </small>
                        </div>
                    </div>

                    <!-- userNameAttribute !?-->
                </div>
            </p-fieldset>
        </div>
        <div class="col-12" *ngIf="readonly!==true">
            <gebo-ui-oauth2-secret-component formControlName="oauth2ClientContent"
                [forcedProviderName]="currentProvider" [oauth2ChoosableScopes]="oauth2ChoosableScopes"
                [oauth2MandatoryScopes]="oauth2MandatoryScopes" [hideProviderChoice]="true">
            </gebo-ui-oauth2-secret-component>
            <!-- 
            <p-fieldset legend="OAUTH2 client registration">

                <div class="grid">
                    <div class="col-12">
                        <div class="flex flex-column gap-2">
                            <label for="tenantId">Tenant ID</label>
                            <input pInputText id="tenantId" formControlName="tenantId" [readOnly]="readonly" 
                                aria-describedby="tenantId-help" />
                            <small id="tenantId-help">
                                Enter the OAUTH2 client registration Tenant Id
                            </small>
                        </div>

                    </div>
                    <div class="col-12">
                        <div class="flex flex-column gap-2">
                            <label for="clientId">Client ID</label>
                            <input pInputText id="clientId" formControlName="clientId" [readOnly]="readonly" 
                                aria-describedby="clientId-help" />
                            <small id="clientId-help">
                                Enter the OAUTH2 client Id
                            </small>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="flex flex-column gap-2">
                            <label for="secret">Secret client key</label>
                            <textarea rows="5" cols="120" pTextarea id="secret" formControlName="secret"
                                aria-describedby="secret-help" [readOnly]="readonly">  </textarea>
                            <small id="secret-help">
                                Client secret for the oauth2 protocol (to be retrieved in the oauth2 authenticated 3rd
                                party software admin area)
                            </small>
                        </div>
                    </div>
                    <div class="col-12" *ngIf="oauth2ChoosableScopes && oauth2ChoosableScopes.length">
                        <div class="flex flex-column gap-2">
                            <label for="scopes">Oauth2 scopes</label>
                            <p-multiselect [options]="oauth2ChoosableScopes" formControlName="scopes"
                                optionLabel="description" optionValue="code" placeholder="Select Oauth2 scopes"
                                styleClass="w-full md:w-80" [readonly]="readonly" />
                            <small id="scopes-help">
                                Scopes for the oauth2 registered client
                            </small>
                        </div>
                    </div>
                    
                </div>
            </p-fieldset>-->
        </div>
    </div>
    <div class="geboButtonsBar" style="vertical-align: baseline;" *ngIf="!isWizardMode">
        <div class="grid">
            <div class="col-4">
                <p-button [outlined]="true" label="Save" (onClick)="doSave()" icon="pi pi-save" severity="success"
                    [disabled]="this.formGroup.invalid || canSave===false || readonly===true"></p-button>
            </div>

            <div class="col-4">
                <p-button [outlined]="true" label="Cancel" severity="contrast" (onClick)="cancelAction.emit(true)" />
            </div>
            <div class="col-4">
                <p-button [outlined]="true" label="Delete" severity="danger" icon="pi pi-trash" (onClick)="doDelete()"
                    [disabled]="readonly===true" />
            </div>

        </div>
    </div>
</p-panel>
<!--
/**
 * This Source Code is subject to the terms of the 
 * Gebo.ai community version Mozilla Public License Version 2.0 (MPL-2.0) â€” With Data Protection Clauses
 * If a copy of the LICENCE was not distributed with this file, You can obtain one at 
 * https://gebo.ai/gebo-ai-community-version-mozilla-public-license-version-2-0-mpl-2-0-with-data-protection-clauses/  
 * and https://mozilla.org/MPL/2.0/.
 * Copyright (c) 2025+ Gebo.ai 
 */
 -->




<p-blockUI [target]="secretEdit" [blocked]="loading">
    <i class="pi pi-lock" style="font-size: 3rem"></i>
</p-blockUI>
<p-panel id="MainPanel" gebo-ai-label  #secretEdit header="Creating identity">
    <div class="geboDialogContent">
        <p-messages [(value)]="userMessages" [enableService]="false" [closable]="false" />
        <div class="grid" [formGroup]="formGroup">
            <div class="col-4">
                <div class="flex flex-column gap-2">
                    <label for="description">Description</label>
                    <input pInputText id="description" formControlName="description" maxlength="120" [required]="true"
                        aria-describedby="description-help" />
                    <small id="description-help">
                        Enter identity description.
                    </small>
                </div>
            </div>
            <div class="col-4">
                <div class="flex flex-column gap-2 ">
                    <label for="code">Unique Code</label>
                    <input pInputText id="code" formControlName="code" aria-describedby="code-help" readonly="true" />
                    <small id="code-help">
                        Automatically generated unique code of the identity.
                    </small>
                </div>
            </div>
            <div class="col-4">
                <div class="flex flex-column gap-2 ">
                    <label for="secretType">Identity type</label>
                    <geboai-editable-listbox-component formControlName="secretType"
                        placeholder="Select the identity type" [required]="true" [data]="choosableTypes"
                        aria-describedby="secretType-help">
                    </geboai-editable-listbox-component>
                    <small id="secretType-help">
                        Select the identity type to create for the remote system
                    </small>
                </div>
            </div>

            <div class="col-12 grid" *ngIf="actualSecretType==='USERNAME_PASSWORD'"
                formGroupName="usernamePasswordContent">
                <div class="col-6">
                    <div class="flex flex-column gap-2">
                        <label for="username">User name</label>
                        <input pInputText id="username" formControlName="username" maxlength="80"
                            aria-describedby="username-help" />
                        <small id="username-help">
                            Enter the user name.
                        </small>
                    </div>
                </div>
                <div class="col-6">
                    <div class="flex flex-column gap-2">
                        <label for="password">Password</label>
                        <p-password id="password" formControlName="password" maxlength="80"
                            aria-describedby="password-help" />

                        <small id="password-help">
                            Enter the password.
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-12 grid" *ngIf="actualSecretType==='TOKEN'" formGroupName="tokenContent">
                <div class="col-12">
                    <div class="flex flex-column gap-2">
                        <label for="user">User</label>
                        <input pInputText id="user" formControlName="user" aria-describedby="user-help" />
                        <small id="username-help">
                            Enter the user indicated by the token.
                        </small>
                    </div>
                </div>
                <div class="col-12">
                    <div class="flex flex-column gap-2">
                        <label for="token">Token</label>
                        <input pInputText id="token" formControlName="token" aria-describedby="token-help" />
                        <small id="username-help">
                            Enter the token.
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-12 grid" *ngIf="actualSecretType==='SSH_KEY'" formGroupName="sshContent">
                <div class="col-6">
                    <div class="flex flex-column gap-2">
                        <label for="email">E-mail/User name</label>
                        <input pInputText id="email" formControlName="email" aria-describedby="email-help" />
                        <small id="email-help">
                            Enter the e-mail or user name associated to the ssh key.
                        </small>
                    </div>
                </div>
                <div class="col-6">
                    <div class="flex flex-column gap-2">
                        <label for="passphrase">Key passphrase</label>
                        <p-password id="passphrase" formControlName="passphrase" maxlength="80"
                            aria-describedby="passphrase-help" />

                        <small id="passphrase-help">
                            Enter the key passphrase.
                        </small>
                    </div>
                </div>
                <div class="col-12">
                    <div class="flex flex-column gap-2">
                        <label for="key">Secret key</label>
                        <textarea rows="5" cols="120" pTextarea id="key" formControlName="key"
                            aria-describedby="key-help">
                    </textarea>
                        <small id="key-help">
                            Open the private key file and copy on this text area.
                        </small>
                    </div>
                </div>
                <div class="col-12">
                    <div class="flex flex-column gap-2">
                        <label for="pub">Public key</label>
                        <textarea rows="5" cols="120" pTextarea id="pub" formControlName="pub"
                            aria-describedby="pub-help">
                    </textarea>
                        <small id="pub-help">
                            Open the public key file and copy on this text area.
                        </small>
                    </div>
                </div>
            </div>

            <div class="col-12 " *ngIf="actualSecretType==='OAUTH2_STANDARD'">
                <gebo-ui-oauth2-secret-component
                    formControlName="oauth2StandardContent" [forcedProviderName]="oauth2ForcedProviderName" [oauth2ChoosableScopes]="oauth2ChoosableScopes" [oauth2MandatoryScopes]="oauth2MandatoryScopes" [hideProviderChoice]="hideProviderChoice">
                </gebo-ui-oauth2-secret-component>
            </div>
            <div class="col-12 grid" *ngIf="actualSecretType==='OAUTH2_GOOGLE'" formGroupName="googleOauth2Content">
                <!-- 
                <div class="col-12">
                    <div class="flex flex-column gap-2">
                        <label for="user">User</label>
                        <input pInputText id="uid" formControlName="uid" 
                            aria-describedby="uid-help" />
                        <small id="username-help">
                            Enter the user indicated by the token.
                        </small>
                    </div>
                </div> -->
                <div class="col-12">
                    <div class="flex flex-column gap-2">
                        <label for="token">Token</label>
                        <input pInputText id="token" formControlName="token" aria-describedby="token-help" />
                        <small id="username-help">
                            Enter the token.
                        </small>
                    </div>
                </div>
                <div class="col-12">
                    <div class="flex flex-column gap-2">
                        <label for="token">projectId</label>
                        <input pInputText id="projectId" formControlName="projectId"
                            aria-describedby="projectId-help" />
                        <small id="username-help">
                            Enter the project id.
                        </small>
                    </div>
                </div>
                <div class="col-12">
                    <div class="flex flex-column gap-2">
                        <label for="token">Location</label>
                        <input pInputText id="location" formControlName="location" aria-describedby="location-help" />
                        <small id="username-help">
                            Enter the location.
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-12" *ngIf="actualSecretType==='GOOGLE_CLOUD_JSON_CREDENTIALS'"
                formGroupName="googleJsonContent">
                <div class="flex flex-column gap-2">
                    <label for="jsonContent">Google credentials file content</label>
                    <textarea pTextarea id="jsonContent" formControlName="jsonContent" rows="10" cols="80"
                        aria-describedby="jsonContent-help">
                    </textarea>
                    <small id="jsonContent-help">
                        Copy here the file content of Google api credentials file downloaded from the google cloud api
                        console (https://console.cloud.google.com/)
                    </small>
                </div>
            </div>
        </div>
        <div class="geboButtonsBar" style="vertical-align: baseline;" *ngIf="!isWizardMode">
            <div class="grid">
                <div class="col-4">
                    <p-button [outlined]="true" label="Insert" (onClick)="doSave()" icon="pi pi-save" severity="success"
                        [disabled]="this.formGroup.invalid || canSave===false" styleClass="w-full"></p-button>
                </div>
                <div class="col-4">
                    <p-button [outlined]="true" label="Cancel" severity="contrast" (onClick)="cancelAction.emit(true)"
                        styleClass="w-full" />
                </div>
                <div class="col-4">
                    <p-button [outlined]="true" label="Delete" severity="danger" icon="pi pi-trash"
                        (onClick)="doDelete()" [disabled]="true" styleClass="w-full" />
                </div>
            </div>
        </div>
    </div>

</p-panel>
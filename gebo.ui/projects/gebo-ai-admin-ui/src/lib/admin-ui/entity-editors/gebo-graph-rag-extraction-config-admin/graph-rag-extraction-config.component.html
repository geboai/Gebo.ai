<p-panel id="MainPanel" gebo-ai-label #graphRagConfigUI header="Graphrag/knowledge extraction configuration"
    [formGroup]="formGroup" gebo-ai-label>
    <p-blockUI [target]="graphRagConfigUI" [blocked]="loading">
        <i class="pi pi-lock" style="font-size: 3rem"></i>
    </p-blockUI>
    <div class=" grid">
        <p-messages [(value)]="userMessages" [enableService]="false" [closable]="false" />
        <p-toast />
        <div class="col-12">
            <h3 *ngIf="defaultConfiguration===true">System global configuration</h3>
            <h3 *ngIf="defaultConfiguration===false">{{configurationLabel}}</h3>
        </div>
        <div class="col-12" style="vertical-align: top;">
            <p-tabView>
                <p-tabPanel id="graphRagConfigUI_ContextSettings" header="General infos/contents settings"
                    gebo-ai-label>
                    <div class="geboDialogMidContent grid ">
                        <div class="col-6">
                            <gebo-ai-field id="description" label="Description" help="Enter the description of this knowledge graph data extraction stage
                                    configuration" [required]="true">
                                <input pInputText gebo-ai-field-element formControlName="description" maxlength="120" />
                            </gebo-ai-field>

                        </div>
                        <div class="col-6">
                            <gebo-ai-field id="code" label="Unique Code" help="Automatically generated unique code of the knowledge graph data extraction
                                    stage">
                                <input pInputText formControlName="code" readonly="true" gebo-ai-field-element />
                            </gebo-ai-field>

                        </div>
                        <div class="col-6" *ngIf="defaultConfiguration===true">
                            <gebo-ai-field id="graphRagAllSources" label="Apply graph rag to all data sources"
                                help="If true all the knowledge bases/project/data sources will be processed for knowldge extraction, otherwise only those specifically configured will be ">
                                <p-checkbox formControlName="graphRagAllSources" [trueValue]="true" [falseValue]="false"
                                    [binary]="true" gebo-ai-field-element></p-checkbox>
                            </gebo-ai-field>

                        </div>
                        <div class="col-6" *ngIf="defaultConfiguration===true"></div>
                        <div class="col-12">
                            <div class="grid"
                                *ngIf="defaultConfiguration===false || (defaultConfiguration===true && graphRagAllSources===true)">
                                <div class="col-3">
                                    <gebo-ai-field id="processEveryDocument" label="Apply graph rag to all files" help="The graph rag algoritms will be applied to all file this will enhance the
                                            details of
                                            analisys that the system is capable of but will high the cost and time
                                            required to process
                                            documents">
                                        <p-checkbox formControlName="processEveryDocument" [trueValue]="true"
                                            [falseValue]="false" [binary]="true" id="processEveryDocument"
                                            gebo-ai-field-element></p-checkbox>
                                    </gebo-ai-field>

                                </div>
                                <div class="col-9" *ngIf="processEveryDocument!==true">
                                    <gebo-ai-field id="contentSelectionFilter"
                                        label="File selection criterias for graphrag processing"
                                        help="Edit criterias on file to send to information extraction pipeline for graphrag, select at least a file name and criteria and/or a file type and/or the maximum number of bytes of file size and/or the age of last modification in days">
                                        <gebo-ai-content-selection-filter-component gebo-ai-field-element
                                            formControlName="contentSelectionFilter"
                                            title=""></gebo-ai-content-selection-filter-component>
                                    </gebo-ai-field>

                                </div>
                            </div>
                        </div>



                        <div class="col-12" style="height: 100%;"></div>
                    </div>
                </p-tabPanel>
                <p-tabPanel id="graphRagConfigUI_LLMSSettings" header="LLms settings" gebo-ai-label>
                    <div class="geboDialogMidContent grid">


                        <div class="col-4">
                            <gebo-ai-field id="usedModelConfiguration" label="LLM used for data extraction" help="Specify large language model used for knowledge extraction, default one will be
                                    used if none is
                                    selected.">
                                <p-select gebo-ai-field-element styleClass="w-full"
                                    formControlName="usedModelConfiguration" styleClass="w-full"
                                    id="usedModelConfiguration" [options]="chatModelsData"
                                    optionLabel="description"></p-select>
                            </gebo-ai-field>

                        </div>
                        <div class="col-4"
                            *ngIf="formGroup.controls['usedModelConfiguration']?.value?false:true && defaultChatModel">
                            <gebo-ai-field id="defaultModel" label="Default large language model"
                                help="The default large language model will be used for knowledge extraction">
                                <label id="defaultModel">{{defaultChatModel?.description}}</label>
                            </gebo-ai-field>

                        </div>
                        <div class="col-4">
                            <gebo-ai-field id="extractionFormat" label="Extraction format"
                                help="Use CSV format for llms under 30b params,JSON form huge frontier models"
                                placeholder="Select format">
                                <geboai-editable-listbox-component formControlName="extractionFormat"
                                    [data]="extractionFormats" [required]="true"></geboai-editable-listbox-component>
                            </gebo-ai-field>
                        </div>
                        <div class="col-12">
                            <gebo-ai-field id="extractionPrompt" label="Information extraction prompt"
                                help="Large language model prompt for entity/events/relation and aliases extraction"
                                [required]="true">
                                <textarea rows="15" cols="250" pTextarea id="extractionPrompt" gebo-ai-field-element
                                    formControlName="extractionPrompt" [required]="true"></textarea>
                            </gebo-ai-field>
                        </div>
                    </div>
                </p-tabPanel>
            </p-tabView>

        </div>

    </div>

    <div class="geboLargeButtonsBar" style="vertical-align: baseline;" *ngIf="!isWizardMode">
        <div class="grid">
            <div class="col-4">
                <p-button id="graphRagConfigUI_Save" [outlined]="true" label="Save" (onClick)="doSave()"
                    icon="pi pi-save" severity="success" gebo-ai-label
                    [disabled]="this.formGroup.invalid || canSave===false || relatedBackendProcessingRunning===true"
                    styleClass="w-full"></p-button>
            </div>

            <div class="col-4">
                <p-button id="graphRagConfigUI_Cancel" [outlined]="true" label="Cancel" severity="contrast"
                    (onClick)="cancelAction.emit(true)" gebo-ai-label styleClass="w-full" />
            </div>
            <div class="col-4">
                <p-button id="graphRagConfigUI_Delete" [outlined]="true" label="Delete" severity="danger"
                    icon="pi pi-trash" (onClick)="doDelete()" gebo-ai-label styleClass="w-full"
                    [disabled]="canDelete===false || relatedBackendProcessingRunning===true" />
            </div>

        </div>
    </div>
</p-panel>
<!-- Treated By refactory robot GeboAIHtmlMultilanguageBot -->
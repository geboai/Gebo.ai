<!--
/**
 * This Source Code is subject to the terms of the 
 * Gebo.ai community version Mozilla Public License Version 2.0 (MPL-2.0) â€” With Data Protection Clauses
 * If a copy of the LICENCE was not distributed with this file, You can obtain one at 
 * https://gebo.ai/gebo-ai-community-version-mozilla-public-license-version-2-0-mpl-2-0-with-data-protection-clauses/  
 * and https://mozilla.org/MPL/2.0/.
 * Copyright (c) 2025+ Gebo.ai 
 */
 -->
 
 
 

<p-blockUI [target]="endPointUI" [blocked]="loading">
  <i class="pi pi-lock" style="font-size: 3rem"></i>
</p-blockUI>
<p-panel id="MainPanel" gebo-ai-label  #endPointUI header="Editing existing filesystem content" [formGroup]="formGroup">
  <div class="geboDialogContent">
    <p-messages [(value)]="userMessages" [enableService]="false" [closable]="false" />
    <p-toast />
    <p-tabView class="standardTabDialogueHeight">
      <p-tabPanel header="Settings">
        <div class="grid">
          
          <div class="col-6">
            <div class="flex flex-column gap-2">
              <label for="description">Description</label>
              <input pInputText id="description" formControlName="description" maxlength="120" [required]="true"
                aria-describedby="description-help" />
              <small id="description-help">
                Enter the description of the uploaded content of filesystem entry.
              </small>
            </div>
          </div>
          <div class="col-6">
            <div class="flex flex-column gap-2 ">
              <label for="code">Unique Code</label>
              <input pInputText id="code" formControlName="code" aria-describedby="code-help" readonly="true" />
              <small id="code-help">
                Automatically generated unique code of the contents.
              </small>
            </div>
          </div>
          <div class="col-6">
            <div class="flex flex-column gap-2 ">
              <label for="parentProjectCode">Project</label>
              <geboai-editable-listbox-component formControlName="parentProjectCode" placeholder="Select a project"
                [required]="true" [optionsObservable]="projectsObservable" [readonly]="cantModifyProject"
                aria-describedby="parentProjectCode-help">

              </geboai-editable-listbox-component>
              <small id="parentProjectCode-help">
                Parent project reference.
              </small>
            </div>
          </div>
          <div class="col-6"></div>
          <div class="col-12">
            <div class="flex flex-column gap-2 ">
              <label for="tree">Choosed files or folders</label>
              <gebo-ai-vfilesystem-selector-component [loadRootsObservable]="loadRootsObservable"
                [readonly]="mode==='EDIT'" formControlName="path" selectionMode="multiple"
                [browsePathObservable]="browsePathObservable" [required]="true" 
                [reconstructNavigationCallback]="reconstructNavigationObservableCallback" [canChooseFolders]="true" [canChooseFiles]="true"
                class="col-12"></gebo-ai-vfilesystem-selector-component>
              <small id="tree-help">
                Shared filesystems files or directories available on the server
              </small>
            </div>
          </div>

          
         
          <div class="col-2">
            <div class="flex flex-column gap-2 ">
              <label for="openZips">Open zip files</label>
              <p-checkbox formControlName="openZips" id="openZips" [binary]="true" [trueValue]="true"
                [falseValue]="false" aria-describedby="openZips-help" ></p-checkbox>
              <small id="openZips-help">
                Enable zip files opening and content extraction
              </small>
            </div>
          </div>
          <div class="col-10">
            <div class="flex flex-column gap-2 ">
              <label for="catalogingCriteria">Folders organization criteria</label>
              <textarea formControlName="catalogingCriteria" id="catalogingCriteria"
                aria-describedby="catalogingCriteria-help" cols="200" rows="2"></textarea>
              <small id="catalogingCriteria-help">
                Please explain here how the folders organization criteria has been done in the file system area you are
                sharing with Gebo.ai
              </small>
            </div>
          </div>
          <div class="col-12">
            <div class="flex flex-column gap-2 ">
              <label for="programmedTables" >Contents updates checks schedule</label>
              <gebo-ai-content-reindex-scheduler-component
                formControlName="programmedTables" id="programmedTables"
                aria-describedby="programmedTables-help"></gebo-ai-content-reindex-scheduler-component>
              <small id="programmedTables-help">
                Configure the scheduling of changed contents to mantain the retrieve augmented generation system updated
              </small>
            </div>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Source code treatment">
        <div class="col-12">
          <div class="flex flex-column gap-2 ">
            <label for="buildSystemsRefs" gebo-translable>Configure build systems</label>
            <gebo-ai-build-systems-chooser id="buildSystemsRefs"
              formControlName="buildSystemsRefs"></gebo-ai-build-systems-chooser>
            <small id="buildSystemsRefs-help">
              List of build/packaging systems to inspect for meta informations and additional artifacts infos
              (leave empty if no software code is contained)
            </small>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Logs" [disabled]="!objectReference">
        <gebo-ai-log-table-component [jobType]="'CONTENTS_READING_VECTORIZING'" [endPointReference]="objectReference"
          title="This shared filesystem area ingestion log"></gebo-ai-log-table-component>
      </p-tabPanel></p-tabView>
  </div>





  <div class="geboLargeButtonsBar" style="vertical-align: baseline;" *ngIf="!isWizardMode">
    <div class="grid">
      <div class="col-3">
        <p-button [outlined]="true" label="Save" (onClick)="doSave()" icon="pi pi-save" severity="success"   styleClass="w-full"  
          [disabled]="this.formGroup.invalid || canSave===false || relatedBackendProcessingRunning===true"></p-button>
      </div>
      <div class="col-3">
        <p-button [outlined]="true" label="Publish!"
          title="Saves and let these contents being available in knowledge base to LLm's" severity="success"   styleClass="w-full" 
          icon="pi pi-microchip-ai" (onClick)="doPublish()"
          [disabled]="this.formGroup.invalid || canSave===false || relatedBackendProcessingRunning===true" />

      </div>
      <div class="col-3">
        <p-button [outlined]="true" label="Cancel" severity="contrast" (onClick)="cancelAction.emit(true)"   styleClass="w-full"  />
      </div>
      <div class="col-3">
        <p-button [outlined]="true" label="Delete" severity="danger" icon="pi pi-trash" (onClick)="doDelete()"
          [disabled]="canDelete===false || relatedBackendProcessingRunning===true"   styleClass="w-full"  />
      </div>

    </div>
  </div>
</p-panel>
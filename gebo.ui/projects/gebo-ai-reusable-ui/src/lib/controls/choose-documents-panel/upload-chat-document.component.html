<ng-template #viewDocumentChips>
    <div class="grid">
        <div class="col-12  justify-content-center" style="text-align: center;">
            <span *ngFor="let doc of uploadedContents" style="list-style: none;break-after: avoid;">
                <p-button id="DocRemoveBtn" gebo-ai-label icon="pi pi-times-circle" [text]="true"
                    (onClick)="doRemoveUploaded(doc)"></p-button><i class="pi pi-cloud-upload"></i> {{doc.fileName}}
            </span>
        </div>
    </div>
</ng-template>

<p-dialog [modal]="true" [maximizable]="true" [visible]="showUpload" [modal]="true" [style]="{width:'50%',height:'50%'}"
    [closable]="true" (visibleChange)="showUploadChange.emit(false)">
    <p-blockUI [blocked]="loading" [target]="uploadFilesArea">
        <i class="pi pi-lock" style="font-size: 3rem"></i>
    </p-blockUI>
    <p-panel id="FilesToChatHeader" #uploadFilesArea header="Upload files to chat with" gebo-ai-label>
        <div class="card">
            <ng-container *ngTemplateOutlet="viewDocumentChips"></ng-container>
        </div>

        <div class="card" [formGroup]="formGroup">
            <p-toast />
           
            <p-fileupload name="files[]"  [url]="url" [multiple]="true" method="post" mode="advanced" [headers]="headers"  [accept]="filesExtensionsFlatList" maxFileSize="10000000"
                
                (onUpload)="onUpload($event)" (onProgress)="sendProgress($event)"   (onSelect)="onSelectedFiles($event)" (onBeforeUpload)="onBeforeUpload($event)" (onError)="onError($event)"  (onSend)="onSend($event)">
                <ng-template #header let-files let-chooseCallback="chooseCallback" let-clearCallback="clearCallback"
                    let-uploadCallback="uploadCallback">
                    <div class="grid w-full">
                        <div class="col-3 grid">
                            <p-button id="ChooseFile" gebo-ai-label title="Choose files"
                                (onClick)="choose($event, chooseCallback)" icon="pi pi-images" class="col-4"
                                [outlined]="true" />
                            <p-button id="UploadFile" gebo-ai-label title="Upload files"
                                (onClick)="uploadEvent(uploadCallback)" icon="pi pi-cloud-upload" severity="success"
                                [disabled]="!files || files.length === 0" class="col-4" [outlined]="true" />
                            <p-button id="RemoveAll" gebo-ai-label title="Remove all" (onClick)="clearCallback()"
                                icon="pi pi-times" severity="danger" [disabled]="!files || files.length === 0"
                                class="col-4" [outlined]="true" />
                        </div>
                        <div class="col-9">
                            <p-progressbar [value]="totalSizePercent" [showValue]="false" class="w-full"
                                styleClass="w-full h-full">
                                <span class="whitespace-nowrap">{{ totalSize }}B / 1Mb</span>
                            </p-progressbar>
                        </div>
                    </div>
                </ng-template>
                <ng-template #content let-files let-uploadedFiles="uploadedFiles"
                    let-removeFileCallback="removeFileCallback"
                    let-removeUploadedFileCallback="removeUploadedFileCallback">
                    <div class="flex flex-col gap-8 pt-4">
                        <div *ngIf="files?.length > 0">
                            <h3 id="UploadPending" gebo-ai-text>Pending for upload</h3>
                            <div class="grid">

                                <div *ngFor="let file of files; let i = index" class="col-12 grid">
                                    <div class="col-1">
                                        <p-button icon="pi pi-times"
                                            (click)="onRemoveTemplatingFile($event, file, removeFileCallback, i)"
                                            [outlined]="true" [rounded]="true" severity="danger" />
                                    </div>
                                    <div class="col-6">
                                        {{file.name}}
                                    </div>
                                    <div class="col-3"><p-badge value="Pending" severity="warn" /></div>
                                    <div class="col-2">{{ formatSize(file.size) }} bytes</div>


                                </div>
                            </div>
                        </div>
                        <div *ngIf="uploadedFiles?.length > 0">
                            <h5 id="CompletedData" gebo-ai-text>Completed</h5>
                            <div class="grid">
                                <div *ngFor="let file of uploadedFiles; let i = index" class="col-12 grid">
                                    <div class="col-1">
                                        <p-button icon="pi pi-times" (onClick)="removeUploadedFileCallback(i)"
                                            [outlined]="true" [rounded]="true" severity="danger" />
                                    </div>
                                    <div class="col-6">
                                        {{file.name}}
                                    </div>
                                    <div class="col-3"> <p-badge value="Completed" class="mt-4" severity="success" />
                                    </div>
                                    <div class="col-2">{{ formatSize(file.size) }} bytes</div>

                                </div>
                            </div>
                        </div>
                    </div>
                </ng-template>
                <ng-template #file></ng-template>
                <ng-template #empty>
                    <div class="grid">
                        <div class="col-12" style="text-align: center;">
                            <div>
                                <h3 id="DragDropHere" gebo-ai-text>Drag and drop files to here to upload</h3>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </p-fileupload>
            
        </div>
    </p-panel>
</p-dialog>
<div class="card" *ngIf="!showUpload">
    <ng-container *ngTemplateOutlet="viewDocumentChips"></ng-container>
</div>